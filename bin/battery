#!/bin/perl

sub get_val {
  my ($f) = @_;
  my $rv = "";
  open(IN, "$f");
  while(<IN>) {
    chomp();
    $rv = $_;
  }
  close(IN);
  return $rv;
}

sub display {
  $FULL = get_val("/sys/class/power_supply/BAT0/charge_full");
  $FULL = get_val("/sys/class/power_supply/BAT0/energy_full") if ($FULL eq "");

  $NOW = get_val("/sys/class/power_supply/BAT0/charge_now");
  $NOW = get_val("/sys/class/power_supply/BAT0/energy_now") if ($NOW eq "");

  $PER = int($NOW/$FULL*100);

  print("\e[2J");
  print("$PER%\n");
}

print("\e[4;64;64t");
while (1) {
  display();
  sleep(2);
}
